<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logowanie - Service Desk App</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>

    <div class="login-container">
        <header class="login-header">
            <h1>Service Desk App</h1>
        </header>

        <main class="login-main">
            <div id="loginSection">
                <p class="login-prompt">Zostaniesz przekierowany na stronę logowania Microsoft. Użyj swojego adresu e-mail i hasła, które zostały dla Ciebie utworzone w systemie.</p>
                <a href="/.auth/login/aad" class="btn-login">Przejdź do logowania</a>
            </div>

            <div id="userInfoSection" class="hidden">
                <p class="welcome-message">Witaj, <span id="userName"></span>!</p>
                <a href="/.auth/logout" class="btn-logout">Wyloguj</a>
            </div>
        </main>
    </div>

    <footer class="site-footer">
        <p>&copy; Dominik Nasiłowski 2026</p>
    </footer>

    <script>
        async function checkAuthState() {
            try {
                const response = await fetch('/.auth/me');
                const data = await response.json();
                
                if (data.clientPrincipal) {
                    const loginSection = document.getElementById('loginSection');
                    const userInfoSection = document.getElementById('userInfoSection');
                    const userNameSpan = document.getElementById('userName');

                    userNameSpan.textContent = data.clientPrincipal.userDetails;
                    
                    loginSection.classList.add('hidden');
                    userInfoSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Błąd podczas sprawdzania stanu uwierzytelnienia:', error);
            }
        }
        checkAuthState();
    </script>

</body>
</html>

